# 🧙‍♂️ cf-frp-traefik-mesh-wizard

![License](https://img.shields.io/badge/License-Apache--2.0-blue.svg)
![Python](https://img.shields.io/badge/Python-3.10%2B-blue)
![CI](https://github.com/run-as-daemon/cf-frp-traefik-mesh-wizard/actions/workflows/ci.yml/badge.svg)

**Декларативный YAML-генератор mesh-сетей для Cloudflare Tunnel + FRP + Traefik**

_Безопасность по дизайну. Скорость по умолчанию._

Превращайте один декларативный YAML-файл топологии в готовые к развертыванию конфигурации для Cloudflare Tunnel (`cloudflared`), FRP (сервер + клиенты) и Traefik (статические + динамические). Идеально подходит для безопасных распределенных сетей, homelabs и production mesh-архитектур.

---

## 🎯 Профессиональное развертывание и поддержка

**Нужна production-grade инфраструктура?**

🌐 **[run-as-daemon.ru](https://run-as-daemon.ru)** предлагает профессиональные услуги по архитектуре mesh-сетей, zero-trust безопасности и автоматизации инфраструктуры:

- 🌐 **Проектирование архитектуры mesh-сетей** - Интеграция и оптимизация Cloudflare Tunnel + FRP + Traefik
- 🔒 **Внедрение Zero-Trust архитектуры** - Сегментация сети, TLS повсюду, политики доступа
- 🏗️ **Infrastructure as Code и GitOps** - Автоматизированные пайплайны развертывания и управление конфигурациями
- 📊 **Настройка высокой доступности и failover** - Мультинодовые кластеры, резервирование, балансировка нагрузки
- 🤖 **CI/CD и автоматизация** - Автоматическая генерация, тестирование и развертывание конфигураций
- 🛡️ **Аудиты безопасности и hardening** - Проверка безопасности mesh-сети, оценка уязвимостей, устранение
- 📈 **Мониторинг и observability** - Логирование, метрики, алертинг для распределенных систем

💬 **Контакты**: [Вебсайт](https://run-as-daemon.ru) | [GitHub](https://github.com/ranas-mukminov) | Telegram/WhatsApp через сайт

_"Безопасность по дизайну. Скорость по умолчанию."_

---

## 🌟 Что это?

`cf-frp-traefik-mesh-wizard` - это Python CLI-инструмент, который превращает единственный декларативный YAML-файл топологии в готовые к развертыванию конфигурации для:
- **Cloudflare Tunnel** (`cloudflared`) - Безопасный входящий трафик из интернета
- **FRP** (Fast Reverse Proxy) - Гибкое туннелирование и проброс портов
- **Traefik** - Современный reverse proxy с динамической маршрутизацией

Инструмент фокусируется на реалистичных цепочках, проходящих через публичные VPS-ноды, Cloudflare access edge, FRP-релеи и приватные LAN-кластеры типа K3s или Docker homelabs.

## 🤔 Зачем это нужно?

Документация обычно описывает Cloudflare Tunnel, Traefik или FRP отдельно. Когда вы объединяете их вместе, становится сложно:
- Понять, какой уровень выполняет TLS-терминацию
- Отладить, почему появляются ошибки 404
- Добавить резервирование и failover
- Поддерживать безопасность во всем стеке

Этот wizard сохраняет топологию **декларативной**, чтобы вы могли воспроизводить и аудитировать сложные пути "Cloudflare → Traefik → FRP → приложение" без специальных скриптов.

## ✨ Возможности

- 📝 **Единая YAML-топология** - Определите всю вашу mesh-сеть в одном декларативном файле с валидацией JSON Schema
- 🔧 **Генерация конфигураций для разных платформ** - Создает готовые к развертыванию конфиги для `cloudflared`, `frps.toml`, `frpc.toml` и Traefik static/dynamic файлов
- 🎨 **Визуальные диаграммы сети** - ASCII-диаграммы, визуализирующие каждый хоп в цепочке для легкого понимания
- 🤖 **Помощь с AI** - Конвертация естественного языка в YAML и предложения вариантов HA/failover
- 🔒 **Безопасность по умолчанию** - Семантические проверки, поощряющие безопасные настройки (FRP auth токены, безопасные ingress правила, TLS-ready роутеры)
- 🚀 **Production-ready** - Разработан для реальных развертываний от homelabs до корпоративных систем

## 🚀 Быстрый старт

### Установка

```bash
pip install -e .
```

### Базовое использование

1. **Создайте файл топологии mesh-сети** с помощью интерактивного визарда или скопируйте из примеров:
   ```bash
   mesh-wizard init
   # или
   cp examples/simple-single-vps.yaml my-mesh.yaml
   ```

2. **Валидируйте топологию**:
   ```bash
   mesh-wizard validate my-mesh.yaml
   ```

3. **Сгенерируйте конфигурации для развертывания**:
   ```bash
   mesh-wizard render my-mesh.yaml --out ./out
   ```

4. **Проверьте и разверните** сгенерированные файлы на соответствующих нодах (VPS, LAN-клиенты, контроллеры кластера)

> 💡 Для детального пошагового руководства см. [QUICKSTART.md](QUICKSTART.md)

### AI-возможности (опционально)

AI-подкоманды (`ai-suggest`, `ai-ha`) требуют настройки провайдера:

```python
from ai_providers.openai_provider import OpenAIProvider
from ai_providers.base import registry

registry.configure(OpenAIProvider(api_key="..."))
```

## 🏗️ Обзор архитектуры

```
┌─────────────────────────────────────────────────────────────────┐
│                    Пользователи Интернета                        │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                  ┌─────────▼──────────┐
                  │  Cloudflare Edge   │
                  │   (Глобальная CDN) │
                  └─────────┬──────────┘
                            │
                  ┌─────────▼──────────┐
                  │ Cloudflare Tunnel  │
                  │   (cloudflared)    │
                  └─────────┬──────────┘
                            │
              ┌─────────────▼─────────────┐
              │    Публичная VPS-нода     │
              │  ┌──────────────────────┐ │
              │  │   Traefik Proxy      │ │
              │  │  (Маршрутизация,TLS) │ │
              │  └──────────┬───────────┘ │
              │  ┌──────────▼───────────┐ │
              │  │    FRP Server        │ │
              │  │  (frps, порт 7000)   │ │
              │  └──────────┬───────────┘ │
              └─────────────┼─────────────┘
                            │ Зашифрованный туннель
              ┌─────────────▼─────────────┐
              │   Приватная LAN/Homelab   │
              │  ┌──────────────────────┐ │
              │  │    FRP Client        │ │
              │  │   (frpc)             │ │
              │  └──────────┬───────────┘ │
              │  ┌──────────▼───────────┐ │
              │  │  K3s/Docker/Прилож.  │ │
              │  │  (Backend-сервисы)   │ │
              │  └──────────────────────┘ │
              └───────────────────────────┘
```

### Как это работает

1. **Cloudflare Edge** - Глобальная CDN и защита от DDoS
2. **Cloudflare Tunnel** - Безопасный ingress без открытия IP-адресов
3. **Traefik на VPS** - Динамическая маршрутизация, TLS-терминация, middleware
4. **FRP-слой** - Гибкое туннелирование между VPS и приватными сетями
5. **Backend-сервисы** - Ваши приложения (K3s, Docker, bare metal)

Wizard генерирует конфигурации для всех этих компонентов из одного YAML-файла.

## 🛠️ Технологический стек

- **Python 3.10+** - Современный Python с type hints
- **Cloudflare Tunnel** - Безопасный ingress без проброса портов
- **FRP** (Fast Reverse Proxy) - Высокопроизводительное туннелирование
- **Traefik v2/v3** - Cloud-native reverse proxy
- **YAML + JSON Schema** - Декларативная конфигурация с валидацией
- **Typer + Rich** - Красивый CLI-интерфейс
- **Опционально: OpenAI** - AI-подсказки по топологии

## 📋 Основы Mesh YAML

Топология вашей mesh-сети определяется в одном YAML-файле с ключевыми секциями:

- **`mesh`** - Метаданные имени и описания
- **`cloudflare`** - Настройки аккаунта/туннеля и маппинг DNS на entrypoints
- **`nodes`** - Публичные VPS, FRP-хабы, LAN-кластеры, edge-устройства с их ролями и сервисами
- **`services`** - Намерения маршрутизации, объясняющие, как связаны роутеры, FRP-прокси и Traefik

См. [`schema/mesh-schema.yaml`](schema/mesh-schema.yaml) и директорию [`examples/`](examples/) для полных справок.

## 📚 Примеры использования

### Простой единственный VPS

```yaml
mesh:
  name: single-vps
  description: Один публичный VPS с Cloudflare tunnel, передающий в Traefik + FRP

cloudflare:
  tunnel_name: vps-homelab
  zone: example.com
  dns:
    - hostname: apps.example.com
      target: service://apps-router

nodes:
  - id: vps-hetzner
    role: public_vps
    public_ip: 203.0.113.10
    frp:
      server: true
      bind_port: 7000
    traefik:
      enabled: true
```

Больше примеров:
- [`examples/simple-single-vps.yaml`](examples/simple-single-vps.yaml)
- [`examples/homelab-k3s-with-mail.yaml`](examples/homelab-k3s-with-mail.yaml)
- [`examples/multi-vps-k3s-lan.yaml`](examples/multi-vps-k3s-lan.yaml)

## 🔒 Лучшие практики безопасности

- ✅ **Замените токены-заполнители** секретами из хранилищ или переменных окружения
- ✅ **Используйте политики Cloudflare Access** и FRP-аутентификацию на каждом открытом туннеле
- ✅ **Включайте TLS везде** - Используйте TLS-ready роутеры Traefik и FRP с шифрованием
- ✅ **Никогда не открывайте admin endpoints** напрямую - Предпочитайте разрешенные hostname'ы
- ✅ **Следуйте принципу минимальных привилегий** - Открывайте только необходимые порты и сервисы
- ✅ **Регулярные аудиты** - Проверяйте сгенерированные конфиги перед развертыванием

Для комплексных рекомендаций по безопасности см. [SECURITY.md](SECURITY.md)

## 🎓 Рекомендации по профессиональному развертыванию

### Для production-использования

1. **Высокая доступность**
   - Развертывайте несколько FRP-серверов за балансировщиками нагрузки
   - Используйте кластеризацию Traefik для failover
   - Внедрите health checks и мониторинг

2. **Zero-Trust архитектура**
   - Cloudflare Access для аутентификации
   - Сегментация сети с FRP
   - TLS-терминация на каждом уровне

3. **Infrastructure as Code**
   - Контроль версий для ваших mesh YAML-файлов
   - Автоматизируйте развертывание с CI/CD
   - Используйте GitOps для управления конфигурациями

4. **Мониторинг и observability**
   - Централизованное логирование (ELK, Loki)
   - Сбор метрик (Prometheus)
   - Distributed tracing (Jaeger, Tempo)

5. **Disaster recovery**
   - Регулярное резервное копирование конфигураций
   - Документируйте процедуры восстановления
   - Тестируйте сценарии failover

**Нужна экспертная помощь?** Обращайтесь на [run-as-daemon.ru](https://run-as-daemon.ru) за профессиональными услугами развертывания.

## 📚 Документация

- 📖 [Руководство быстрого старта](QUICKSTART.md) - Начните работу за 5 минут
- 🚀 [Руководство по развертыванию](DEPLOYMENT.md) - Комплексные инструкции по развертыванию
- 🔒 [Политика безопасности](SECURITY.md) - Лучшие практики безопасности и отчетность
- 🤝 [Руководство по участию](CONTRIBUTING.md) - Как внести вклад
- 📜 [Кодекс поведения](CODE_OF_CONDUCT.md) - Правила сообщества
- 📋 [История изменений](CHANGELOG.md) - История релизов

## 👨‍💻 Автор и профессиональные услуги

Создано и поддерживается **Ранасом Мукминовым** ([@ranas-mukminov](https://github.com/ranas-mukminov))

### Профессиональные услуги от run-as-daemon.ru

🌐 **[run-as-daemon.ru](https://run-as-daemon.ru)** - _"Безопасность по дизайну. Скорость по умолчанию."_

Специализация в DevSecOps, SRE и автоматизации инфраструктуры с фокусом на:

#### 🌐 Архитектура Mesh-сетей
- **Проектирование и планирование** - Разработка кастомной топологии mesh-сети для вашей инфраструктуры
- **Интеграция Cloudflare** - Настройка туннелей, политик Access, защиты от DDoS
- **Оптимизация FRP** - Высокопроизводительное туннелирование, мультисайтовая связность
- **Конфигурация Traefik** - Продвинутая маршрутизация, middleware, управление TLS

#### 🔒 Zero-Trust безопасность
- **Сегментация сети** - Изоляция сервисов и окружений
- **TLS везде** - Внедрение end-to-end шифрования
- **Контроль доступа** - Политики аутентификации и авторизации
- **Аудиты безопасности** - Комплексная проверка безопасности mesh-сети

#### 🏗️ Infrastructure as Code
- **Внедрение GitOps** - Автоматизированные пайплайны развертывания
- **Управление конфигурациями** - Декларативная инфраструктура
- **Интеграция CI/CD** - Автоматизированное тестирование и развертывание
- **Настройка множественных окружений** - Dev, staging, production workflows

#### 📊 Высокая доступность и производительность
- **Мультинодовые кластеры** - Резервирование и failover
- **Балансировка нагрузки** - Распределение и оптимизация трафика
- **Мониторинг здоровья** - Автоматизированные health checks и восстановление
- **Тюнинг производительности** - Оптимизация для высоконагруженных сценариев

#### 🛡️ Операции и поддержка
- **Мониторинг 24/7** - Проактивное обнаружение проблем
- **Реагирование на инциденты** - Быстрое решение проблем
- **Планирование мощностей** - Стратегии масштабирования
- **Обучение и документация** - Передача знаний вашей команде

### Контакты и поддержка

- 🌐 **Вебсайт**: [run-as-daemon.ru](https://run-as-daemon.ru)
- 🐙 **GitHub**: [@ranas-mukminov](https://github.com/ranas-mukminov)
- 💬 **Telegram/WhatsApp**: Доступно через вебсайт
- 📧 **Email**: Контактная форма на вебсайте

## 🤝 Участие в разработке

Вклады приветствуются! См. [CONTRIBUTING.md](CONTRIBUTING.md) для руководства.

### Настройка окружения разработки

```bash
# Клонируйте репозиторий
git clone https://github.com/ranas-mukminov/cf-frp-traefik-mesh-wizard.git
cd cf-frp-traefik-mesh-wizard

# Установите зависимости
pip install -e .[dev]

# Запустите форматирование и линтинг
scripts/format.sh
scripts/lint.sh

# Запустите тесты
pytest
```

## ⚖️ Юридическая информация и ответственное использование

Работайте только с инфраструктурой, которой владеете или на управление которой имеете разрешение. Соблюдайте условия использования Cloudflare, FRP, Traefik и вашего хостинг-провайдера. Этот проект автоматизирует легитимные рабочие процессы конфигурирования и не должен использоваться для обхода файрволов или нарушения политик приемлемого использования.

См. [LEGAL.md](LEGAL.md) для дополнительной информации.

## 📄 Лицензия

Apache License 2.0. См. [LICENSE](LICENSE) для деталей.

---

## 🌍 English Version

Full English documentation is available in [README.md](README.md)
